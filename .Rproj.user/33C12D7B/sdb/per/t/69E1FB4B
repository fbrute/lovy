{
    "contents" : "mainreg = function (){\n        dbg = 0\n        \n        library(RMySQL)\n        library(ggplot2)\n        \n        load(\"~/Documents/Trafin/lovy/soundingbymonth/df.powers2k12.RData\")\n        input = list\n        input$year = 2009\n        input$start_date = \"2008-01-01\"\n        input$end_date = \"2008-12-31\"\n        \n        QueryString = \"select date(datetime) as date, avg(pmptp) as pm10 from pm10 where year(datetime) = 2012 and pmptp > 0 group by date(datetime) order by date(datetime)\"\n        #QueryString = \"select date(datetime) as date, avg(pmptp) as pm10 from pm10 where year(datetime) = 2012 and pmptp > 0 and hour(datetime) between 8 and 9 group by date(datetime) order by date(datetime)\"\n        entropicQueryString = \"select avg(pmptp) as pm10 from pm10 where date(datetime) between '2012-01-01' and '2012-02-28' and jour != 'Dimanche'\"\n        \n        df.pm10 = getMysqlData(QueryString)\n        entropic = 19.4058\n        #entropic = 22\n        df.pm10$pm10 = ifelse((df.pm10$pm10 - entropic) >= 0,df.pm10$pm10 - entropic , 0)\n        \n        df.pm10 = subset(df.pm10, pm10>0)\n        \n        df.powers = subset(df.powers, as.character.factor(date) != \"2012-02-07\")\n        \n        df.pmpowers <- merge(df.powers, df.pm10, by=c(\"date\"),all.x = T, all.y = T)\n        # plot(df.pmpowers$power, df.pmpowers$pm10)\n        # \n        # g <- ggplot(df.pmpowers)\n        # #g + aes(power, pm10) + geom_point() + geom_smooth(method=\"lm\")\n        # g + aes(power, pm10) + geom_point(alpha = 1/3) + geom_smooth(method=\"lm\")\n        #lm( power ~ pm10, df.pmpowers)\n        \n        #cor(df.pmpowers$power, df.pmpowers$pm10, use = \"complete.obs\")\n        \n        #QueryString = \"select avg(pmptp) as pm10 from pm10 where date(datetime) between \"2012-01-01\" and \"2012-03-31\" and jour <=> \"dimanche\"\"\n        #df.inversions = getMysqlData(QueryString)\n        \n        if (dbg) browser()\n        \n        \n        if (dbg) browser()\n        df.pminvpowers <- within(na.omit(df.pmpowers), \n                                    inversion <- cut(power, quantile(power,\n                                                                     probs =c(0, 0.5, 1),\n                                                                     na.rm = TRUE), \n                                                    include.lowest=TRUE, \n                                                    labels=c(\"weak\",\"strong\"))\n                                    )\n        \n        if (dbg) browser()\n        \n        dfs <- split(df.pminvpowers, df.pminvpowers$inversion)\n        \n        cors = round(as.numeric(unlist(\n                        lapply(dfs, function(elt) cor(x=elt$pm10, y=elt$power, use =\"complete.obs\"))\n                        )\n                        )\n                ,2)\n        df.cors <- data.frame(levels(df.pminvpowers$inversion), cors)\n        colnames(df.cors) <- c(\"inversion\", \"cor\")\n        library(dplyr)\n        df.cors <- mutate(df.cors, cor = paste(\"cor:\", cor, sep=\"\")) \n        row.names(df.cors) <- 1:2\n        \n        if (dbg) browser()\n        \n        g <- ggplot(df.pminvpowers)\n        #g + aes(power, pm10) + geom_point() + geom_smooth(method=\"lm\")\n        #ginv = g + aes(power, pm10) + facet_wrap(~ inversion, scales = \"free\") + geom_point(alpha = 1/3) + geom_smooth(method=\"lm\") \n        ginv = g + aes(power, pm10) + facet_wrap(~ inversion) + geom_point(alpha = 1/3) + geom_smooth(method=\"lm\") \n        \n        ginv = ginv + geom_text(data = df.cors, aes(x = 350, y = 90, label = cor, size = 7), color =\"red\" , inherit.aes = FALSE, parse = T)\n        ginv = ginv + ggtitle(\"Regressions in 2012\")\n        plot(ginv)\n        ggsave(ginv, file='regressions2012_2_levels.pdf')\n}\n\n# testAddQuantiles <- function(df){\n#         for (i in 1:nrow(df)) {\n#            quantiles =  quantile(df$power)\n#            q0 = quantile[1]\n#            q1 = quantile[2]\n#            power = df[i,3]\n#            if power >= quantiles[1] & df\n#    \n#         }\n# }\n",
    "created" : 1414156987280.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3887661112",
    "id" : "69E1FB4B",
    "lastKnownWriteTime" : 1414157340,
    "path" : "~/Documents/Trafin/lovy/power/regressions/regression1.9.R",
    "project_path" : "power/regressions/regression1.9.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}